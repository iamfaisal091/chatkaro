<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern YouTube Video Site with JSON</title>
  <style>
    /* ===== सामान्य स्टाइल ===== */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Inter, sans-serif; }
    body { background: #111; color: #fff; min-height: 100vh; }
    h1 { padding: 20px; text-align: center; font-weight: 600; font-size: 24px; }

    /* ===== स्केलेटन लोडिंग स्टाइल ===== */
    .skeleton { background: #333; border-radius: 12px; overflow: hidden; animation: pulse 1.5s infinite; }
    .skeleton .thumb { width: 100%; aspect-ratio: 16/9; background: #222; }
    .skeleton .meta { padding: 10px; }
    .skeleton .meta h3, .skeleton .meta p { background: #444; height: 16px; margin-bottom: 4px; border-radius: 4px; }
    .skeleton .meta p { width: 60%; height: 13px; }
    .skeleton-player { background: #222; width: 100%; height: 100%; border-radius: 12px; animation: pulse 1.5s infinite; position: absolute; top: 0; left: 0; }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* ===== वीडियो लिस्ट ===== */
    .video-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; padding: 16px; max-width: 1200px; margin: 0 auto; }
    .video-card { background: #1a1a1a; border-radius: 12px; overflow: hidden; cursor: pointer; transition: transform .2s; }
    .video-card:hover { transform: scale(1.02); }
    .thumb { width: 100%; aspect-ratio: 16/9; overflow: hidden; background: #000; position: relative; }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .meta { padding: 10px; }
    .meta h3 { font-size: 16px; color: #fff; margin-bottom: 4px; }
    .meta p { font-size: 13px; color: #aaa; }

    /* ===== मोडल (प्लेयर विंडो) ===== */
    .modal { position: fixed; inset: 0; display: none; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.95); z-index: 1000; }
    .modal.show { display: flex; }
    .player-wrapper { width: 90%; max-width: 960px; background: #000; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; transition: all .3s ease; }
    .player-area { position: relative; width: 100%; padding-top: 56.25%; }
    #ytPlayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
    .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent; z-index: 5; } /* बटन्स के नीचे */

    /* ===== कंट्रोल्स ===== */
    .controls { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0, 0, 0, 0.7); }
    .controls-left { display: flex; gap: 10px; align-items: center; }
    .btn, select { background: #222; color: #fff; border: none; border-radius: 8px; padding: 6px 12px; cursor: pointer; transition: 0.2s; font-size: 14px; }
    .btn:hover, select:hover { background: #333; }
    .controls-right { display: flex; gap: 10px; align-items: center; }

    /* ===== मिनी-प्लेयर ===== */
    .mini-player { position: fixed; bottom: 16px; right: 16px; width: 320px; height: 180px; border-radius: 12px; overflow: hidden; background: #000; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5); display: none; z-index: 1100; }
    .mini-player iframe { width: 100%; height: 100%; }
    .mini-controls { position: absolute; bottom: 8px; left: 8px; display: flex; gap: 6px; z-index: 10; } /* बटन्स के लिए ऊपर */
    .mini-controls button { padding: 4px 8px; font-size: 12px; }

    /* ===== रेस्पॉन्सिव डिज़ाइन ===== */
    @media (max-width: 700px) {
      .video-list { grid-template-columns: 1fr; }
      .player-wrapper { width: 100vw; max-width: 100%; border-radius: 0; }
      .mini-player { width: 100vw; height: calc(100vw * 9 / 16); bottom: 0; right: 0; border-radius: 0; }
    }
  </style>
</head>
<body>

  <h1>मेरा वीडियो साइट (JSON सपोर्ट)</h1>
  <div class="video-list" id="videoList"></div>

  <!-- मोडल -->
  <div class="modal" id="modal">
    <div class="player-wrapper" id="playerWrapper">
      <div class="player-area" id="playerArea">
        <div class="skeleton-player"></div>
        <div class="overlay"></div>
      </div>
      <div class="controls">
        <div class="controls-left">
          <button id="playPauseBtn" class="btn">▶ Play</button>
          <button id="minimizeBtn" class="btn">⤢ Minimize</button>
        </div>
        <div class="controls-right">
          <label style="color: #ccc;">Quality</label>
          <select id="qualitySelect"></select>
          <button id="closeBtn" class="btn">✖ Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- मिनी-प्लेयर -->
  <div class="mini-player" id="miniPlayer">
    <div class="skeleton-player"></div>
    <div id="miniPlayerArea"></div>
    <div class="overlay" style="z-index: 5;"></div>
    <div class="mini-controls">
      <button id="miniPlayPause" class="btn">▶</button>
      <button id="restoreBtn" class="btn">⤢</button>
    </div>
  </div>

  <script>
    // DOM एलिमेंट्स
    const videoList = document.getElementById('videoList');
    const modal = document.getElementById('modal');
    const playerArea = document.getElementById('playerArea');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const minimizeBtn = document.getElementById('minimizeBtn');
    const closeBtn = document.getElementById('closeBtn');
    const qualitySelect = document.getElementById('qualitySelect');
    const miniPlayer = document.getElementById('miniPlayer');

    let ytPlayer = null;
    let miniPlayerInstance = null;
    let currentVideoId = null;
    let currentTime = 0;
    let isPlayerReady = false;
    let isMiniPlayerReady = false;
    let currentState = null;

    // JSON से वीडियो डेटा लोड करें
    let videos = [];
    function loadVideoData() {
      console.log("Loading video data from JSON");
      showSkeletonCards(); // स्केलेटन दिखाएँ
      fetch('videos.json')
        .then(response => {
          if (!response.ok) throw new Error('JSON फाइल लोड करने में त्रुटि');
          return response.json();
        })
        .then(data => {
          videos = data;
          loadVideoList();
        })
        .catch(error => {
          console.error("JSON लोड करने में त्रुटि:", error);
          alert("JSON फाइल लोड नहीं हो सकी। कृपया 'videos.json' फाइल चेक करें।");
        });
    }

    // स्केलेटन लोडिंग कार्ड्स जोड़ें
    function showSkeletonCards() {
      console.log("Showing skeleton cards");
      videoList.innerHTML = '';
      for (let i = 0; i < 5; i++) {
        const card = document.createElement('div');
        card.className = 'video-card skeleton';
        card.innerHTML = `
          <div class="thumb"></div>
          <div class="meta">
            <h3></h3>
            <p></p>
          </div>`;
        videoList.appendChild(card);
      }
    }

    // YouTube लिंक से वीडियो ID निकालें
    function extractVideoId(url) {
      const match = url.match(/[?&]v=([^&]+)/);
      return match ? match[1] : null;
    }

    // वीडियो लिस्ट जनरेट करें
    function loadVideoList() {
      console.log("Loading video list from JSON");
      videoList.innerHTML = '';
      videos.forEach(v => {
        const videoId = extractVideoId(v.link);
        if (videoId) {
          const card = document.createElement('div');
          card.className = 'video-card';
          card.innerHTML = `
            <div class="thumb"><div class="skeleton-player"></div><img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" onerror="this.src='https://via.placeholder.com/480x270'" onload="this.previousSibling.style.display='none'"></div>
            <div class="meta"><h3>${v.description}</h3><p>Click to play</p></div>`;
          card.addEventListener('click', () => openVideo(videoId));
          videoList.appendChild(card);
        } else {
          console.warn("Invalid YouTube link:", v.link);
        }
      });
    }

    // शुरू में JSON डेटा लोड करें
    loadVideoData();

    // YouTube Iframe API लोड करें
    let tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    tag.onload = () => console.log("YouTube Iframe API Loaded");
    tag.onerror = () => console.error("Failed to load YouTube Iframe API");
    document.head.appendChild(tag);

    // YouTube API तैयार होने पर
    function onYouTubeIframeAPIReady() {
      console.log("onYouTubeIframeAPIReady called");
      try {
        playerArea.innerHTML = '<div class="skeleton-player"></div><div class="overlay"></div>';
        ytPlayer = new YT.Player('playerArea', {
          height: '100%',
          width: '100%',
          videoId: '',
          playerVars: { modestbranding: 1, rel: 0, controls: 0, playsinline: 1 },
          events: {
            'onReady': (event) => {
              console.log("Main YT.Player is ready");
              isPlayerReady = true;
              const skeleton = playerArea.querySelector('.skeleton-player');
              if (skeleton) skeleton.style.display = 'none';
              if (currentVideoId) {
                event.target.loadVideoById({ videoId: currentVideoId, suggestedQuality: 'auto' });
                setTimeout(updateQualityOptions, 1500);
              }
            },
            'onStateChange': onPlayerStateChange,
            'onError': (error) => console.error("Main YT.Player Error:", error.data, error)
          }
        });
      } catch (error) {
        console.error("Error initializing main YT.Player:", error);
      }
    }

    // वीडियो खोलें
    function openVideo(id) {
      console.log("openVideo called with ID:", id);
      currentVideoId = id;
      modal.classList.add('show');
      miniPlayer.style.display = 'none';
      const skeleton = playerArea.querySelector('.skeleton-player');
      if (skeleton) skeleton.style.display = 'block';
      if (isPlayerReady) {
        if (skeleton) skeleton.style.display = 'none';
        ytPlayer.loadVideoById({ videoId: id, suggestedQuality: 'auto' });
        setTimeout(updateQualityOptions, 1500);
      } else {
        console.warn("Waiting for main player to be ready");
      }
      if (miniPlayerInstance && isMiniPlayerReady) {
        try {
          miniPlayerInstance.destroy();
          miniPlayerInstance = null;
          isMiniPlayerReady = false;
          console.log("Mini player destroyed on openVideo");
        } catch (error) {
          console.error("Error destroying mini player:", error);
        }
      }
    }

    // क्वालिटी ड्रॉपडाउन अपडेट करें (केवल 144p, 240p, 360p)
    function updateQualityOptions() {
      if (!ytPlayer || !isPlayerReady) {
        console.warn("Main player not ready for quality update");
        return;
      }
      try {
        console.log("Updating quality options");
        const allowedQualities = ['tiny', 'small', 'medium']; // 144p, 240p, 360p
        const qualities = ytPlayer.getAvailableQualityLevels().filter(q => allowedQualities.includes(q));
        qualitySelect.innerHTML = '';
        if (!qualities || qualities.length === 0) {
          const opt = document.createElement('option');
          opt.value = 'auto';
          opt.textContent = 'Auto';
          qualitySelect.appendChild(opt);
        } else {
          qualities.forEach(q => {
            const opt = document.createElement('option');
            opt.value = q;
            opt.textContent = q === 'tiny' ? '144p' : q === 'small' ? '240p' : '360p';
            qualitySelect.appendChild(opt);
          });
        }
        const currentQ = ytPlayer.getPlaybackQuality() || 'auto';
        qualitySelect.value = currentQ;
        console.log("Quality options updated:", qualities);
      } catch (error) {
        console.error("Error updating quality options:", error);
      }
    }

    // प्ले/पॉज़ टॉगल
    playPauseBtn.addEventListener('click', () => {
      if (!ytPlayer || !isPlayerReady) {
        console.warn("Main player not ready for play/pause");
        return;
      }
      try {
        const state = ytPlayer.getPlayerState();
        console.log("Main Play/Pause button clicked, current state:", state);
        if (state === YT.PlayerState.PLAYING) {
          ytPlayer.pauseVideo();
        } else {
          ytPlayer.playVideo();
        }
      } catch (error) {
        console.error("Error in main play/pause:", error);
      }
    });

    // मिनी-प्लेयर में वीडियो लोड करें
    minimizeBtn.addEventListener('click', () => {
      if (!ytPlayer || !currentVideoId || !isPlayerReady) {
        console.warn("No video loaded or main player not ready");
        alert("कोई वीडियो लोड नहीं है या प्लेयर तैयार नहीं है।");
        return;
      }
      try {
        console.log("Minimizing player");
        currentTime = ytPlayer.getCurrentTime();
        currentState = ytPlayer.getPlayerState();
        ytPlayer.pauseVideo();
        modal.classList.remove('show');
        miniPlayer.style.display = 'block';
        miniPlayer.innerHTML = `
          <div class="skeleton-player"></div>
          <div id="miniPlayerArea"></div>
          <div class="overlay" style="z-index: 5;"></div>
          <div class="mini-controls">
            <button id="miniPlayPause" class="btn">▶</button>
            <button id="restoreBtn" class="btn">⤢</button>
          </div>`;
        miniPlayerInstance = new YT.Player('miniPlayerArea', {
          height: '100%',
          width: '100%',
          videoId: currentVideoId,
          playerVars: {
            modestbranding: 1,
            rel: 0,
            controls: 0,
            playsinline: 1,
            start: Math.floor(currentTime)
          },
          events: {
            'onReady': (event) => {
              console.log("Mini player is ready");
              isMiniPlayerReady = true;
              const skeleton = miniPlayer.querySelector('.skeleton-player');
              if (skeleton) skeleton.style.display = 'none';
              if (currentState === YT.PlayerState.PLAYING) {
                event.target.playVideo();
              }
              bindMiniPlayerButtons();
            },
            'onStateChange': (event) => {
              console.log("Mini player state changed:", event.data);
              const miniPlayPause = document.getElementById('miniPlayPause');
              if (miniPlayPause) {
                miniPlayPause.textContent = event.data === YT.PlayerState.PLAYING ? '⏸' : '▶';
              }
            },
            'onError': (error) => console.error("Mini player error:", error.data, error)
          }
        });
      } catch (error) {
        console.error("Error minimizing player:", error);
      }
    });

    // मिनी-प्लेयर बटन्स बाइंड करें
    function bindMiniPlayerButtons() {
      const miniPlayPause = document.getElementById('miniPlayPause');
      const restoreBtn = document.getElementById('restoreBtn');
      if (!miniPlayPause || !restoreBtn) {
        console.error("Mini player buttons not found");
        return;
      }
      const newMiniPlayPause = miniPlayPause.cloneNode(true);
      miniPlayPause.parentNode.replaceChild(newMiniPlayPause, miniPlayPause);
      const newRestoreBtn = restoreBtn.cloneNode(true);
      restoreBtn.parentNode.replaceChild(newRestoreBtn, restoreBtn);

      newMiniPlayPause.addEventListener('click', () => {
        if (!miniPlayerInstance || !isMiniPlayerReady) {
          console.warn("Mini player not ready for play/pause");
          return;
        }
        try {
          const state = miniPlayerInstance.getPlayerState();
          console.log("Mini Play/Pause button clicked, current state:", state);
          if (state === YT.PlayerState.PLAYING) {
            miniPlayerInstance.pauseVideo();
            newMiniPlayPause.textContent = '▶';
          } else {
            miniPlayerInstance.playVideo();
            newMiniPlayPause.textContent = '⏸';
          }
        } catch (error) {
          console.error("Error in mini play/pause:", error);
        }
      });
      newRestoreBtn.addEventListener('click', () => {
        console.log("Restoring to modal");
        if (miniPlayerInstance) {
          currentTime = miniPlayerInstance.getCurrentTime();
          currentState = miniPlayerInstance.getPlayerState();
          miniPlayerInstance.destroy();
          miniPlayerInstance = null;
          isMiniPlayerReady = false;
          console.log("Mini player destroyed on restore");
        }
        modal.classList.add('show');
        miniPlayer.style.display = 'none';
        const skeleton = playerArea.querySelector('.skeleton-player');
        if (skeleton) skeleton.style.display = 'none';
        if (isPlayerReady) {
          ytPlayer.loadVideoById({ videoId: currentVideoId, startSeconds: currentTime, suggestedQuality: 'auto' });
          if (currentState === YT.PlayerState.PLAYING) {
            ytPlayer.playVideo();
          }
          setTimeout(updateQualityOptions, 1500);
        }
      });
    }

    // मोडल बंद करें
    closeBtn.addEventListener('click', () => {
      console.log("Closing modal");
      modal.classList.remove('show');
      miniPlayer.style.display = 'none';
      if (ytPlayer && isPlayerReady) {
        try {
          ytPlayer.stopVideo();
        } catch (error) {
          console.error("Error stopping video:", error);
        }
      }
      if (miniPlayerInstance && isMiniPlayerReady) {
        try {
          miniPlayerInstance.destroy();
          miniPlayerInstance = null;
          isMiniPlayerReady = false;
          console.log("Mini player destroyed on close");
        } catch (error) {
          console.error("Error destroying mini player:", error);
        }
      }
    });

    // क्वालिटी बदलें
    qualitySelect.addEventListener('change', (e) => {
      if (!ytPlayer || !currentVideoId || !isPlayerReady) {
        console.warn("Main player or videoId not ready for quality change");
        return;
      }
      try {
        console.log("Changing quality to:", e.target.value);
        const currentTime = ytPlayer.getCurrentTime();
        ytPlayer.loadVideoById({ videoId: currentVideoId, startSeconds: currentTime, suggestedQuality: e.target.value });
        setTimeout(updateQualityOptions, 1500);
      } catch (error) {
        console.error("Error changing quality:", error);
      }
    });

    // प्लेयर स्टेट चेंज
    function onPlayerStateChange(event) {
      try {
        console.log("Main player state changed:", event.data);
        if (event.data === YT.PlayerState.PLAYING) {
          playPauseBtn.textContent = '⏸ Pause';
        } else {
          playPauseBtn.textContent = '▶ Play';
        }
      } catch (error) {
        console.error("Error in onPlayerStateChange:", error);
      }
    }
  </script>
</body>
</html>